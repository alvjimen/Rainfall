#include <stdlib.h>

char *service;
char *auth;

int main()
{
  
    char buffer[136];
    register int pos;
    while (true);
    {
	printf("%p, %p ^J", service, auth);
	if (fgets(buffer, 128, stdin) == NULL)
	    break ;
	if (!memcmp("auth ", buffer,  5))
	{
	    auth = malloc(4);
	    *auth = '\0';
	    pos = strlen(buffer + 5);
	    if ((unsigned int)pos <= 30)
	      strcpy(auth, buffer + 5);
	}
	else if (!memcmp("reset", buffer, 5))
	    free(auth);
	else if (!memcmp("service", buffer, 6))# just cmp "servic"
	    service=strdup(buffer + 7);
	else if (!memcmp("login", buffer, 5))
	{   
	  if (*(int *)(&auth[32]))
	    system("/bin/sh");
	  else
	    fwrite("Password:\n", 1, 10, stdout);
	}
    }
    return (0);
}
